<!-- users.component.html -->
<!-- users.component.html -->
<app-settings></app-settings>

<div class="container" dir="rtl">
  <div class="card-container">
    <div class="card">
      <!-- Header -->
      <div class="card-header">
        <h1 class="responsive-heading text-center">شاشة المستخدمين</h1>
      </div>

      <!-- Body -->
      <div class="card-body">
        <h4 class="form-title text-center">
          {{ isEditing ? 'تعديل مستخدم' : 'إضافة مستخدم' }}
        </h4>

        <!-- User Form -->
        <form (ngSubmit)="onSubmit()" #userForm="ngForm" class="user-form">
          <div class="form-grid">
            <!-- Username -->
            <div class="form-group">
              <label for="username" class="form-label">اسم المستخدم</label>
              <input type="text" id="username" class="form-control" required [(ngModel)]="user.username"
                name="username" />
            </div>

            <!-- Email -->
            <div class="form-group">
              <label for="email" class="form-label">البريد الإلكتروني</label>
              <input type="email" id="email" class="form-control" required [(ngModel)]="user.email" name="email"
                #email="ngModel" />
              <div *ngIf="email.invalid && email.touched" class="error-message">
                الرجاء إدخال بريد إلكتروني صالح.
              </div>
            </div>

            <!-- Nickname -->
            <div class="form-group">
              <label for="nickname" class="form-label">اختصار اسم المستخدم</label>
              <input type="text" id="nickname" class="form-control" required [(ngModel)]="user.nickname"
                name="nickname" />
            </div>

            <!-- Password -->
            <div class="form-group">
              <label for="password" class="form-label">كلمة المرور</label>
              <input type="password" id="password" class="form-control" required [(ngModel)]="user.password"
                name="password" />
            </div>
          </div>
          <div class="button-group">

            <button type="submit" class="btn btn-primary" (click)="generateQRCode(userName, password, twoFactorCode)">
              {{ isEditing ? 'تحديث' : 'حفظ' }}
            </button>


            <div *ngIf="qrCodeImage">
              <h3>رمز QR الخاص بك:</h3>
              <img [src]="qrCodeImage" alt="QR Code">
            </div>




            <!-- قسم عرض صورة الـ QR (قادمة من السيرفر بصيغة Base64) -->
            <div class="qr-base64-section" *ngIf="base64Image">
              <h5>صورة الـ QR من السيرفر:</h5>
              <img [src]="base64Image" alt="QR Code from Server" style="max-width: 200px; margin-bottom: 1rem;" />
            </div>
            <!-- 
<div class="qr-section" *ngIf="qrCodeData">
  <h5>رمز QR الذي ولّدناه محلياً:</h5>
  <div class="qr-wrapper">
    <qrcode
      [qrdata]="qrCodeData"
      [width]="getQRCodeSize()"
      [errorCorrectionLevel]="'M'"
    ></qrcode> -->

            <!-- <div class="qr-info">
      <p><strong>اسم المستخدم:</strong> {{ user.username }}</p>
      <p><strong>كلمة المرور:</strong> {{ user.password }}</p>
      <p *ngIf="otpResponse?.SecretKey">
        <strong>رمز السر:</strong> {{ otpResponse.SecretKey }}
      </p>
    </div>-->
            <!-- </div>  -->
            <!-- </div> -->

            <img [src]="base64Image" alt="QR Code" *ngIf="base64Image" />


          </div>
        </form>



      </div>
    </div>